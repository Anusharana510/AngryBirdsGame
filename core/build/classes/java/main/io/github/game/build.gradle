buildscript {
  repositories {
    gradlePluginPortal()
    mavenCentral()
    google()
  }
  dependencies {
    if (enableGraalNative == 'true') {
      classpath "org.graalvm.buildtools.native:org.graalvm.buildtools.native.gradle.plugin:0.9.28"
    }
  }
}

plugins {
  id "io.github.fourlastor.construo" version "1.4.1"
  id "application"
}

[compileJava, compileTestJava]*.options*.encoding = 'UTF-8'

ext {
  lwjglVersion = "3.3.1"
  gdxVersion = '1.9.12'
  gdxControllersVersion = '1.9.12'
  gdxBasisUniversalVersion = '1.9.12'
  lmlVersion = '1.12.1'
  appName = 'game'
  projectVersion = '1.0.0'
}

sourceSets.main.resources.srcDirs += [rootProject.file('assets').path]
mainClassName = 'io.github.game.lwjgl3.Lwjgl3Launcher'
application.setMainClass(mainClassName)
eclipse.project.name = appName + '-lwjgl3'
java.sourceCompatibility = 17
java.targetCompatibility = 17

dependencies {
//  implementation project(':core')
  implementation "com.badlogicgames.gdx:gdx-backend-lwjgl3:$gdxVersion"
  implementation "com.badlogicgames.gdx:gdx-platform:$gdxVersion:natives-desktop"
  implementation "com.badlogicgames.gdx:gdx-controllers:$gdxControllersVersion"
  implementation "com.badlogicgames.gdx:gdx-controllers-lwjgl3:$gdxControllersVersion"
  implementation "com.crashinvaders.basisu:basisu-wrapper:1.0.2"
  implementation 'org.mini2Dx:universal-tween-engine:6.3.3'
  implementation 'org.xerial:sqlite-jdbc:3.46.1.3'

  if (enableGraalNative == 'true') {
    implementation "io.github.berstanio:gdx-svmhelper-backend-lwjgl3:$graalHelperVersion"
  }
}

def os = System.properties['os.name'].toLowerCase()

run {
  workingDir = rootProject.file('assets').path
  setIgnoreExitValue(true)

  if (os.contains('mac')) {
    jvmArgs += "-XstartOnFirstThread"
  }
}
jar {
  archiveFileName.set("${appName}-${projectVersion}.jar")
  duplicatesStrategy DuplicatesStrategy.EXCLUDE
  from { configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) } }
  exclude('META-INF/INDEX.LIST', 'META-INF/.SF', 'META-INF/.DSA', 'META-INF/*.RSA')
  manifest {
    attributes 'Main-Class': mainClassName
  }
  doLast {
    file(archiveFile).setExecutable(true, false)
  }
}


